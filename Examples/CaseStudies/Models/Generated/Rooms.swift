/// ═══════════════════════════════════════════════════════════════════════════════
/// Rooms.swift
/// Generated by InstantSchemaCodegen
/// ═══════════════════════════════════════════════════════════════════════════════
///
/// ⚠️  DO NOT EDIT - This file is generated from your InstantDB schema.
/// Any changes will be overwritten on the next codegen run.
///
/// ─────────────────────────────────────────────────────────────────────────────────
/// WHAT THIS FILE IS
/// ─────────────────────────────────────────────────────────────────────────────────
///
/// This file defines type-safe room keys and presence types for real-time features:
/// • Presence - See who's online, their cursor positions, typing status, etc.
/// • Topics - Fire-and-forget events like emoji reactions, notifications
/// Rooms are accessed via `Schema.Rooms.<roomName>` and topics via
/// `Schema.Topics.<topicName>`.
///
/// ─────────────────────────────────────────────────────────────────────────────────
/// HOW TO USE
/// ─────────────────────────────────────────────────────────────────────────────────
///
/// PRESENCE - Track who's online and their state:
///   @Shared(.instantPresence(
///     Schema.Rooms.avatars,
///     roomId: "my-room-id",
///     initialPresence: AvatarsPresence(name: "", color: "")
///   ))
///   var presence: RoomPresence<AvatarsPresence>
/// Access presence data:
///   presence.user        // Your presence data
///   presence.peers       // Other users in the room
///   presence.totalCount  // Total users including you
/// Update your presence:
///   $presence.withLock { $0.user = AvatarsPresence(...) }
///
/// ─────────────────────────────────────────────────────────────────────────────────
/// QUICK START - Copy & Paste Example
/// ─────────────────────────────────────────────────────────────────────────────────

/* Copy-pasteable example:

import SwiftUI
import SharingInstant

struct AvatarsRoomView: View {
  @Shared(.instantPresence(
    Schema.Rooms.avatars,
    roomId: "demo-room",
    initialPresence: AvatarsPresence(name: "", color: "")
  ))
  private var presence: RoomPresence<AvatarsPresence>

  var body: some View {
    VStack {
      Text("People in room: \(presence.totalCount)")
        .font(.headline)

      // Your presence
      Text("You: \(presence.user)")
        .font(.caption)

      // Other users
      ForEach(presence.peers) { peer in
        Text("Peer \(peer.id): \(peer.data)")
          .font(.caption)
          .foregroundStyle(.secondary)
      }
    }
    .onAppear {
      // Update your presence when view appears
      $presence.withLock { state in
        state.user = AvatarsPresence(name: "", color: "")
      }
    }
  }
}

// TOPIC EXAMPLE - Fire-and-forget events:

struct EmojiTopicView: View {
  @Shared(.instantTopic(
    Schema.Topics.emoji,
    roomId: "demo-room"
  ))
  private var channel: TopicChannel<EmojiTopic>

  var body: some View {
    Button("Send Event") {
      channel.publish(EmojiTopic(name: "value", directionAngle: 0, rotationAngle: 0))
    }
    .onReceive(channel.events) { event in
      print("Received from \(event.peerId): \(event.data)")
    }
  }
}
*/

///
/// ─────────────────────────────────────────────────────────────────────────────────
/// AVAILABLE IN THIS FILE
/// ─────────────────────────────────────────────────────────────────────────────────
///
/// ROOMS:
///
/// Schema.Rooms.avatars → AvatarsPresence {
///   name: String
///   color: String
/// }
///
/// Schema.Rooms.chat → ChatPresence {
///   name: String
///   color: String
///   isTyping: Bool
/// }
///
/// Schema.Rooms.cursors → CursorsPresence {
///   name: String
///   color: String
///   cursorX: Double
///   cursorY: Double
/// }
///
/// Schema.Rooms.reactions → ReactionsPresence {
///   name: String
/// }
///
/// Schema.Rooms.tileGame → TileGamePresence {
///   name: String
///   color: String
/// }
///
/// TOPICS:
///
/// Schema.Topics.emoji → EmojiTopic {
///   room: "reactions"
///   payload: {
///     name: String
///     directionAngle: Double
///     rotationAngle: Double
///   }
/// }
///

///
/// ─────────────────────────────────────────────────────────────────────────────────
/// GENERATION INFO
/// ─────────────────────────────────────────────────────────────────────────────────
///
/// Mode:            Production (full traceability)
/// Generated:       December 30, 2025 at 8:23 PM EST
/// Machine:         mlustig-hy7l9xrd61.local (Apple M4 Pro, macOS 26.2)
/// Generator:       Sources/instant-schema/main.swift
/// Source Schema:   Examples/CaseStudies/instant.schema.ts

/* To regenerate this file, run:

swift run instant-schema generate \
  --from Examples/CaseStudies/instant.schema.ts \
  --to Examples/CaseStudies/Models/Generated
*/
/// ─────────────────────────────────────────────────────────────────────────────────
/// GIT STATE AT GENERATION
/// ─────────────────────────────────────────────────────────────────────────────────
///
/// HEAD Commit:
///   SHA:      9e86d9473bf7479d459636330853fa2e4a72a1f4
///   Date:     December 30, 2025 at 7:12 PM EST
///   Author:   Michael Lustig <mlustig@hioscar.com>
///   Message:  chore: Regenerate schema files with final commit hash
///
/// Schema File Last Modified:
///   SHA:      522ffbf617207b60ecfa647b2d1dc6b9bfa3a7ff
///   Date:     December 22, 2025 at 6:46 AM EST
///   Author:   Michael Lustig <mlustig@hioscar.com>
///   Message:  fix: Remove recursive self-link to fix Swift compilation
///
/// ═══════════════════════════════════════════════════════════════════════════════

import Foundation
import SharingInstant
import InstantDB

// MARK: - Room Presence Types

/// Presence data for 'avatars' room.
public struct AvatarsPresence: PresenceData {
  public var name: String
  public var color: String

  public init(
    name: String,
    color: String
  ) {
    self.name = name
    self.color = color
  }
}

/// Presence data for 'chat' room.
public struct ChatPresence: PresenceData {
  public var name: String
  public var color: String
  public var isTyping: Bool

  public init(
    name: String,
    color: String,
    isTyping: Bool
  ) {
    self.name = name
    self.color = color
    self.isTyping = isTyping
  }
}

/// Presence data for 'cursors' room.
public struct CursorsPresence: PresenceData {
  public var name: String
  public var color: String
  public var cursorX: Double
  public var cursorY: Double

  public init(
    name: String,
    color: String,
    cursorX: Double,
    cursorY: Double
  ) {
    self.name = name
    self.color = color
    self.cursorX = cursorX
    self.cursorY = cursorY
  }
}

/// Presence data for 'reactions' room.
public struct ReactionsPresence: PresenceData {
  public var name: String

  public init(
    name: String
  ) {
    self.name = name
  }
}

/// Presence data for 'tileGame' room.
public struct TileGamePresence: PresenceData {
  public var name: String
  public var color: String

  public init(
    name: String,
    color: String
  ) {
    self.name = name
    self.color = color
  }
}

// MARK: - Topic Payload Types

/// Topic payload for 'reactions.emoji' events.
public struct EmojiTopic: Codable, Sendable, Equatable {
  public var name: String
  public var directionAngle: Double
  public var rotationAngle: Double

  public init(
    name: String,
    directionAngle: Double,
    rotationAngle: Double
  ) {
    self.name = name
    self.directionAngle = directionAngle
    self.rotationAngle = rotationAngle
  }
}

// MARK: - Room Keys

public extension Schema {
  /// Type-safe room keys for presence subscriptions.
  enum Rooms {
    /// 'avatars' room - presence sync
    public static let avatars = RoomKey<AvatarsPresence>(type: "avatars")

    /// 'chat' room - presence sync
    public static let chat = RoomKey<ChatPresence>(type: "chat")

    /// 'cursors' room - presence sync
    public static let cursors = RoomKey<CursorsPresence>(type: "cursors")

    /// 'reactions' room - presence sync
    public static let reactions = RoomKey<ReactionsPresence>(type: "reactions")

    /// 'tileGame' room - presence sync
    public static let tileGame = RoomKey<TileGamePresence>(type: "tileGame")

  }
}

// MARK: - Topic Keys

public extension Schema {
  /// Type-safe topic keys for fire-and-forget events.
  enum Topics {
    /// 'emoji' topic in 'reactions' room
    public static let emoji = TopicKey<EmojiTopic>(roomType: "reactions", topic: "emoji")

  }
}

// MARK: - Presence Mutations

// MARK: AvatarsPresence Mutations

public extension Shared where Value == RoomPresence<AvatarsPresence> {

  /// Set the entire user presence at once.
  ///
  /// This replaces all presence fields with the new values.
  ///
  /// ## Example
  ///
  /// ```swift
  /// $presence.setUser(AvatarsPresence(...))
  /// ```
  @MainActor
  public func setUser(_ user: AvatarsPresence, callbacks: MutationCallbacks<Void> = .init()) {
    callbacks.onMutate?()
    withLock { $0.user = user }
    callbacks.onSuccess?(())
    callbacks.onSettled?()
  }
  /// Set the entire user presence with named parameters.
  ///
  /// ## Example
  ///
  /// ```swift
  /// $presence.setUser(
  ///   name: value,
  ///   color: value
  /// )
  /// ```
  @MainActor
  public func setUser(
    name: String,
    color: String,
    callbacks: MutationCallbacks<Void> = .init()
  ) {
    setUser(AvatarsPresence(
      name: name,
      color: color
    ), callbacks: callbacks)
  }
  // MARK: Name (String)

  /// Set name to a specific value.
  @MainActor
  public func setName(_ value: String, callbacks: MutationCallbacks<Void> = .init()) {
    callbacks.onMutate?()
    withLock { $0.user.name = value }
    callbacks.onSuccess?(())
    callbacks.onSettled?()
  }
  // MARK: Color (String)

  /// Set color to a specific value.
  @MainActor
  public func setColor(_ value: String, callbacks: MutationCallbacks<Void> = .init()) {
    callbacks.onMutate?()
    withLock { $0.user.color = value }
    callbacks.onSuccess?(())
    callbacks.onSettled?()
  }
}

// MARK: ChatPresence Mutations

public extension Shared where Value == RoomPresence<ChatPresence> {

  /// Set the entire user presence at once.
  ///
  /// This replaces all presence fields with the new values.
  ///
  /// ## Example
  ///
  /// ```swift
  /// $presence.setUser(ChatPresence(...))
  /// ```
  @MainActor
  public func setUser(_ user: ChatPresence, callbacks: MutationCallbacks<Void> = .init()) {
    callbacks.onMutate?()
    withLock { $0.user = user }
    callbacks.onSuccess?(())
    callbacks.onSettled?()
  }
  /// Set the entire user presence with named parameters.
  ///
  /// ## Example
  ///
  /// ```swift
  /// $presence.setUser(
  ///   name: value,
  ///   color: value,
  ///   isTyping: value
  /// )
  /// ```
  @MainActor
  public func setUser(
    name: String,
    color: String,
    isTyping: Bool,
    callbacks: MutationCallbacks<Void> = .init()
  ) {
    setUser(ChatPresence(
      name: name,
      color: color,
      isTyping: isTyping
    ), callbacks: callbacks)
  }
  // MARK: Name (String)

  /// Set name to a specific value.
  @MainActor
  public func setName(_ value: String, callbacks: MutationCallbacks<Void> = .init()) {
    callbacks.onMutate?()
    withLock { $0.user.name = value }
    callbacks.onSuccess?(())
    callbacks.onSettled?()
  }
  // MARK: Color (String)

  /// Set color to a specific value.
  @MainActor
  public func setColor(_ value: String, callbacks: MutationCallbacks<Void> = .init()) {
    callbacks.onMutate?()
    withLock { $0.user.color = value }
    callbacks.onSuccess?(())
    callbacks.onSettled?()
  }
  // MARK: IsTyping (Bool)

  /// Set isTyping to a specific value.
  @MainActor
  public func setIsTyping(_ value: Bool, callbacks: MutationCallbacks<Void> = .init()) {
    callbacks.onMutate?()
    withLock { $0.user.isTyping = value }
    callbacks.onSuccess?(())
    callbacks.onSettled?()
  }

  /// Toggle isTyping between true and false.
  @MainActor
  public func toggleIsTyping(callbacks: MutationCallbacks<Void> = .init()) {
    callbacks.onMutate?()
    withLock { $0.user.isTyping.toggle() }
    callbacks.onSuccess?(())
    callbacks.onSettled?()
  }

  /// Set isTyping to true.
  @MainActor
  public func startTyping(callbacks: MutationCallbacks<Void> = .init()) {
    setIsTyping(true, callbacks: callbacks)
  }

  /// Set isTyping to false.
  @MainActor
  public func stopTyping(callbacks: MutationCallbacks<Void> = .init()) {
    setIsTyping(false, callbacks: callbacks)
  }
}

// MARK: CursorsPresence Mutations

public extension Shared where Value == RoomPresence<CursorsPresence> {

  /// Set the entire user presence at once.
  ///
  /// This replaces all presence fields with the new values.
  ///
  /// ## Example
  ///
  /// ```swift
  /// $presence.setUser(CursorsPresence(...))
  /// ```
  @MainActor
  public func setUser(_ user: CursorsPresence, callbacks: MutationCallbacks<Void> = .init()) {
    callbacks.onMutate?()
    withLock { $0.user = user }
    callbacks.onSuccess?(())
    callbacks.onSettled?()
  }
  /// Set the entire user presence with named parameters.
  ///
  /// ## Example
  ///
  /// ```swift
  /// $presence.setUser(
  ///   name: value,
  ///   color: value,
  ///   cursorX: value,
  ///   cursorY: value
  /// )
  /// ```
  @MainActor
  public func setUser(
    name: String,
    color: String,
    cursorX: Double,
    cursorY: Double,
    callbacks: MutationCallbacks<Void> = .init()
  ) {
    setUser(CursorsPresence(
      name: name,
      color: color,
      cursorX: cursorX,
      cursorY: cursorY
    ), callbacks: callbacks)
  }
  // MARK: Name (String)

  /// Set name to a specific value.
  @MainActor
  public func setName(_ value: String, callbacks: MutationCallbacks<Void> = .init()) {
    callbacks.onMutate?()
    withLock { $0.user.name = value }
    callbacks.onSuccess?(())
    callbacks.onSettled?()
  }
  // MARK: Color (String)

  /// Set color to a specific value.
  @MainActor
  public func setColor(_ value: String, callbacks: MutationCallbacks<Void> = .init()) {
    callbacks.onMutate?()
    withLock { $0.user.color = value }
    callbacks.onSuccess?(())
    callbacks.onSettled?()
  }
  // MARK: Cursor Coordinates

  /// Update cursor coordinates.
  ///
  /// ## Example
  ///
  /// ```swift
  /// $presence.updateCursor(x: 100, y: 200)
  /// ```
  @MainActor
  public func updateCursor(x: Double, y: Double, callbacks: MutationCallbacks<Void> = .init()) {
    callbacks.onMutate?()
    withLock { state in
      state.user.cursorX = x
      state.user.cursorY = y
    }
    callbacks.onSuccess?(())
    callbacks.onSettled?()
  }

  /// Clear cursor coordinates (set to 0, 0).
  @MainActor
  public func clearCursor(callbacks: MutationCallbacks<Void> = .init()) {
    updateCursor(x: 0, y: 0, callbacks: callbacks)
  }
}

// MARK: ReactionsPresence Mutations

public extension Shared where Value == RoomPresence<ReactionsPresence> {

  /// Set the entire user presence at once.
  ///
  /// This replaces all presence fields with the new values.
  ///
  /// ## Example
  ///
  /// ```swift
  /// $presence.setUser(ReactionsPresence(...))
  /// ```
  @MainActor
  public func setUser(_ user: ReactionsPresence, callbacks: MutationCallbacks<Void> = .init()) {
    callbacks.onMutate?()
    withLock { $0.user = user }
    callbacks.onSuccess?(())
    callbacks.onSettled?()
  }
  /// Set the entire user presence with named parameters.
  ///
  /// ## Example
  ///
  /// ```swift
  /// $presence.setUser(
  ///   name: value
  /// )
  /// ```
  @MainActor
  public func setUser(
    name: String,
    callbacks: MutationCallbacks<Void> = .init()
  ) {
    setUser(ReactionsPresence(
      name: name
    ), callbacks: callbacks)
  }
  // MARK: Name (String)

  /// Set name to a specific value.
  @MainActor
  public func setName(_ value: String, callbacks: MutationCallbacks<Void> = .init()) {
    callbacks.onMutate?()
    withLock { $0.user.name = value }
    callbacks.onSuccess?(())
    callbacks.onSettled?()
  }
}

// MARK: TileGamePresence Mutations

public extension Shared where Value == RoomPresence<TileGamePresence> {

  /// Set the entire user presence at once.
  ///
  /// This replaces all presence fields with the new values.
  ///
  /// ## Example
  ///
  /// ```swift
  /// $presence.setUser(TileGamePresence(...))
  /// ```
  @MainActor
  public func setUser(_ user: TileGamePresence, callbacks: MutationCallbacks<Void> = .init()) {
    callbacks.onMutate?()
    withLock { $0.user = user }
    callbacks.onSuccess?(())
    callbacks.onSettled?()
  }
  /// Set the entire user presence with named parameters.
  ///
  /// ## Example
  ///
  /// ```swift
  /// $presence.setUser(
  ///   name: value,
  ///   color: value
  /// )
  /// ```
  @MainActor
  public func setUser(
    name: String,
    color: String,
    callbacks: MutationCallbacks<Void> = .init()
  ) {
    setUser(TileGamePresence(
      name: name,
      color: color
    ), callbacks: callbacks)
  }
  // MARK: Name (String)

  /// Set name to a specific value.
  @MainActor
  public func setName(_ value: String, callbacks: MutationCallbacks<Void> = .init()) {
    callbacks.onMutate?()
    withLock { $0.user.name = value }
    callbacks.onSuccess?(())
    callbacks.onSettled?()
  }
  // MARK: Color (String)

  /// Set color to a specific value.
  @MainActor
  public func setColor(_ value: String, callbacks: MutationCallbacks<Void> = .init()) {
    callbacks.onMutate?()
    withLock { $0.user.color = value }
    callbacks.onSuccess?(())
    callbacks.onSettled?()
  }
}

// MARK: - Topic Mutations

// MARK: EmojiTopic Mutations

public extension Shared where Value == TopicChannel<EmojiTopic> {

  /// Send a emoji event with named parameters.
  ///
  /// ## Example
  ///
  /// ```swift
  /// $channel.sendEmoji(
  ///   name: value,
  ///   directionAngle: value,
  ///   rotationAngle: value
  /// )
  /// ```
  @MainActor
  public func sendEmoji(
    name: String,
    directionAngle: Double = 0,
    rotationAngle: Double = 0,
    onAttempt: ((EmojiTopic) -> Void)? = nil,
    onError: ((Error) -> Void)? = nil,
    onSettled: (() -> Void)? = nil
  ) {
    let payload = EmojiTopic(
      name: name,
      directionAngle: directionAngle,
      rotationAngle: rotationAngle
    )
    wrappedValue.publish(payload, onAttempt: onAttempt, onError: onError, onSettled: onSettled)
  }
}

